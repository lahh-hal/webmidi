<!DOCTYPE html>
<html>
  <head>
    <style>
      #grid {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <canvas id="grid" width="600" height="300"></canvas>
    <label for="velocity-slider">Velocity:</label>
    <input type="range" id="velocity-slider" min="0" max="127" value="100"/>
    <button id="play-button">Play</button>
    <input type="file" id="input-file" accept="audio/mid"/>
    <script>
      var midiAccess;
      var output;
      var grid;
      var notes = [];
      var velocity;
      var fileInput = document.querySelector("#input-file");
  
      window.addEventListener("load", function() {
        navigator.requestMIDIAccess().then(onMIDISuccess, onMIDIFailure);
        fileInput.addEventListener("change", function() {
          var file = fileInput.files[0];
          var reader = new FileReader();
          reader.onload = function() {
            var midiData = new Uint8Array(reader.result);
            // parse the midi file and extract the notes
            // ...
            render();
          };
          reader.readAsArrayBuffer(file);
        });
      });
  
      function onMIDISuccess(midi) {
        midiAccess = midi;
        output = midiAccess.outputs.values().next().value;
        velocity = document.querySelector("#velocity-slider").value;
        document.querySelector("#velocity-slider").addEventListener("input", updateVelocity);
        document.querySelector("#play-button").addEventListener("click", playMIDI);
        grid = document.querySelector("#grid");
        grid.addEventListener("mousedown", addNote);
        render();
      }
  
      function onMIDIFailure(error) {
        console.error("Could not access MIDI devices: " + error);
      }
  
      function updateVelocity(event) {
        velocity = event.target.value;
      }
  
      function addNote(event) {
        var x = event.clientX - grid.offsetLeft;
        var y = event.clientY - grid.offsetTop;
        var note = {
          x: x,
          y: y,
          velocity: velocity,
          duration: 100
        };
        notes.push(note);
        render();
      }
  
      function playMIDI() {
        for (var i = 0; i < notes.length; i++) {
          var note = notes[i];
          // send MIDI message to play the note
          // ...
        }
      }
  
      function render() {
        // draw the notes on the grid
        // ...
      }
    </script>
  </body>
</html>
